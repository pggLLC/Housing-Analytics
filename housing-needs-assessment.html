<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Housing Needs Assessment | Affordable Housing Intelligence</title>
  <meta name="description" content="Interactive Housing Needs Assessment starter for Colorado communities: housing stock, affordability, commuting, and demographic projections using public datasets." />
  <link rel="stylesheet" href="css/site-theme.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/pages.css">
  <link rel="stylesheet" href="css/pages/housing-needs-assessment.css">
  <!-- Leaflet (vendored locally — no CDN required) -->
  <link rel="stylesheet" href="js/vendor/leaflet.css" />
  <script src="js/path-resolver.js"></script>
  <script src="js/config.js"></script>
  <script src="js/fetch-helper.js"></script>
  <script src="js/data-service-portable.js"></script>
  <script src="js/scroll-fix.js"></script>
  <script src="js/api-config-wrapper.js"></script>
  <!-- Vendor scripts -->
  <script defer src="js/vendor/leaflet.js"></script>
  <script defer src="js/vendor/chart.umd.min.js"></script>
  <!-- PDF export (client-side) -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script defer src="js/navigation.js"></script>
  <script defer src="js/dark-mode-toggle.js"></script>
  <script defer src="js/mobile-menu.js"></script>
  <script defer src="js/housing-needs-assessment.js"></script>
</head>
<body>
  <a class="skip-link" href="#main-content">Skip to main content</a>
  <main id="main-content">
    <section class="hero" style="padding-bottom:0;">
      <div style="padding:0 var(--sp4) var(--sp4);">
        <div class="kicker">Colorado • Public Data</div>
        <h1>Housing Needs Assessment</h1>
        <p class="sub" style="max-width:none;margin-bottom:var(--sp3);">
          A report-style, data-driven snapshot for Colorado communities: housing stock, tenure, affordability,
          commuting, and demographic change. Powered by cached public datasets with live Census API fallbacks.
        </p>
        <div id="hnaBanner" class="banner"></div>
        <div class="hna-controls" style="margin-top:var(--sp3);">
          <label style="color:var(--muted);font-weight:700" for="geoType">Geography type</label>
          <select id="geoType">
            <option value="county">County</option>
            <option value="place">Municipality</option>
            <option value="cdp">Census-Designated Place (CDP)</option>
          </select>

          <label style="color:var(--muted);font-weight:700" for="geoSelect">Select geography</label>
          <select id="geoSelect"></select>

          <button id="btnRefresh" type="button">Refresh</button>
          <button id="btnPdf" type="button" title="Exports the current assessment view to a PDF">Download PDF</button>
        </div>
      </div>
    </section>

    <section class="hna-grid">
      <div class="chart-card span-12">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
          <h2 style="margin:0">Executive Snapshot</h2>
          <div class="pill" id="geoContextPill">—</div>
        </div>
        <p id="execNarrative">Select a geography to generate an HNA-style baseline narrative.</p>
        <div class="stats" aria-label="Headline indicators">
          <div class="stat"><div class="k">Population</div><div class="v" id="statPop">—</div><div class="s" id="statPopSrc">—</div></div>
          <div class="stat"><div class="k">Median household income</div><div class="v" id="statMhi">—</div><div class="s" id="statMhiSrc">—</div></div>
          <div class="stat"><div class="k">Median home value</div><div class="v" id="statHomeValue">—</div><div class="s" id="statHomeValueSrc">—</div></div>
          <div class="stat"><div class="k">Median gross rent</div><div class="v" id="statRent">—</div><div class="s" id="statRentSrc">—</div></div>

          <div class="stat"><div class="k">Tenure</div><div class="v" id="statTenure">—</div><div class="s">Owner vs renter</div></div>
          <div class="stat"><div class="k">Rent burdened (≥30%)</div><div class="v" id="statRentBurden">—</div><div class="s">ACS GRAPI bins</div></div>
          <div class="stat"><div class="k">Income needed to buy (est.)</div><div class="v" id="statIncomeNeed">—</div><div class="s" id="statIncomeNeedNote">30% of income rule</div></div>
          <div class="stat"><div class="k">Mean commute time</div><div class="v" id="statCommute">—</div><div class="s">ACS S0801</div></div>
        </div>
      </div>

      <div class="chart-card span-8">
        <h2>Map</h2>
        <p>Boundary is fetched from Census TIGERweb and used as the base layer for additional overlays.</p>
        <div id="hnaMap" aria-label="Boundary map"></div>
        <div style="margin-top:10px">
          <details>
            <summary>Local commitments & resources</summary>
            <div id="localResources" style="margin-top:8px;color:var(--muted)">—</div>
          </details>
        </div>
      </div>

      <div class="chart-card span-4">
        <h2>Housing stock & tenure</h2>
        <p>Existing housing stock by structure type and owner/renter shares (ACS).</p>
        <div class="chart-box"><canvas id="chartStock"></canvas></div>
        <div class="chart-box"><canvas id="chartTenure"></canvas></div>
      </div>

      <div class="chart-card span-6">
        <h2>Affordability</h2>
        <p>What income is needed to afford the typical home value using a simple, transparent mortgage model (assumptions shown below).</p>
        <div class="chart-box"><canvas id="chartAfford"></canvas></div>
        <details style="margin-top:10px">
          <summary>Affordability assumptions (editable in JS)</summary>
          <div id="affordAssumptions" style="margin-top:8px;color:var(--muted)">—</div>
        </details>
      </div>

      <div class="chart-card span-6">
        <h2>Rent burden distribution</h2>
        <p>Share of renter households by gross rent as a percent of income (ACS DP04 / GRAPI bins).</p>
        <div class="chart-box"><canvas id="chartRentBurdenBins"></canvas></div>
      </div>

      <div class="chart-card span-6">
        <h2>Commuting: mode share</h2>
        <p>Travel mode split (ACS S0801).</p>
        <div class="chart-box"><canvas id="chartMode"></canvas></div>
      </div>

      <div class="chart-card span-6">
        <h2>Commuting: inflow & outflow (LEHD LODES)</h2>
        <p>
          Workplace-based flows: <strong>inflow</strong> = jobs located here filled by residents of other counties;
          <strong>outflow</strong> = residents working elsewhere; <strong>within</strong> = live+work here.
        </p>
        <div class="chart-box"><canvas id="chartLehd"></canvas></div>
        <p id="lehdNote" style="margin-top:8px">—</p>
      </div>

      <div class="chart-card span-12">
        <h2>Demographic projections: age pyramid & senior pressure (DOLA/SDO)</h2>
        <p>
          County-level single-year-of-age estimates/forecasts used to illustrate aging pressure and household formation dynamics.
          For municipal/CDP selections, this uses the containing county as context.
        </p>
        <div class="hna-grid" style="margin-top:0">
          <div class="chart-card span-6" style="margin:0">
            <h2 style="font-size:1rem">Age pyramid</h2>
            <div class="chart-box tall"><canvas id="chartPyramid"></canvas></div>
          </div>
          <div class="chart-card span-6" style="margin:0">
            <h2 style="font-size:1rem">Senior growth pressure</h2>
            <div class="chart-box"><canvas id="chartSenior"></canvas></div>
            <p id="seniorNote" style="margin-top:8px">—</p>
          </div>
        </div>
      </div>

      <div class="chart-card span-12">
        <h2>20-year outlook: population, migration, and housing needs (county context)</h2>
        <p>
          Uses Colorado State Demography Office county components-of-change forecasts (population + net migration) and a transparent
          household/headship conversion to estimate additional housing units needed over the next 20 years.
          For municipal/CDP selections, this uses the containing county.
        </p>
        <div class="hna-grid" style="margin-top:0">
          <div class="chart-card span-8" style="margin:0">
            <h2 style="font-size:1rem">Population: DOLA forecast vs historic-trend sensitivity</h2>
            <div class="chart-box tall"><canvas id="chartPopProj"></canvas></div>
          </div>
          <div class="chart-card span-4" style="margin:0">
            <h2 style="font-size:1rem">Housing need summary</h2>
            <div class="stats" style="grid-template-columns:repeat(2,minmax(0,1fr));margin-top:10px">
              <div class="stat"><div class="k">Base year (units)</div><div class="v" id="statBaseUnits">—</div><div class="s" id="statBaseUnitsSrc">—</div></div>
              <div class="stat"><div class="k">Target vacancy</div><div class="v" id="statTargetVac">—</div><div class="s">Assumption</div></div>
              <div class="stat"><div class="k">Units needed (20y)</div><div class="v" id="statUnitsNeed">—</div><div class="s">DOLA forecast</div></div>
              <div class="stat"><div class="k">Net migration (20y)</div><div class="v" id="statNetMig">—</div><div class="s">DOLA components</div></div>
            </div>
            
            <div class="chart-card" style="padding:12px;margin-top:12px;background:rgba(255,255,255,.04)">
              <h3 style="margin:0 0 8px;font-size:.95rem">Projection assumptions</h3>
              <div class="hna-grid" style="grid-template-columns:repeat(12,1fr);gap:10px;margin-top:0">
                <div class="span-4">
                  <label for="assumpHorizon" style="display:block;color:var(--muted);font-size:.85rem;margin-bottom:4px">Horizon</label>
                  <select id="assumpHorizon" class="control" style="width:100%">
                    <option value="5">5 years</option>
                    <option value="10">10 years</option>
                    <option value="15">15 years</option>
                    <option value="20" selected>20 years</option>
                    <option value="25">25 years</option>
                    <option value="30">30 years</option>
                  </select>
                </div>
                <div class="span-4">
                  <label for="assumpVacancy" style="display:block;color:var(--muted);font-size:.85rem;margin-bottom:4px">Target vacancy</label>
                  <div style="display:flex;gap:8px;align-items:center">
                    <input id="assumpVacancy" type="range" min="2" max="12" step="0.5" value="5" style="flex:1" />
                    <div style="min-width:56px;text-align:right;color:var(--text);font-weight:700" id="assumpVacancyVal">5.0%</div>
                  </div>
                </div>
                <div class="span-4">
                  <div style="color:var(--muted);font-size:.85rem;margin-bottom:4px">Headship</div>
                  <div style="display:flex;gap:10px;flex-wrap:wrap">
                    <label style="display:flex;gap:6px;align-items:center"><input type="radio" name="assumpHeadship" value="hold" checked> Hold</label>
                    <label style="display:flex;gap:6px;align-items:center"><input type="radio" name="assumpHeadship" value="trend"> Trend</label>
                  </div>
                </div>
              </div>
              <p style="margin:10px 0 0;color:var(--muted);font-size:.9rem">
                Transparent HNA math: projected households = population × headship; units needed = households ÷ (1 − vacancy).
                For municipalities/CDPs, projections scale from the containing county using current population share and recent relative growth.
              </p>
            </div>

            <p id="needNote" style="margin-top:10px;color:var(--muted)">—</p>
          </div>
        </div>
      </div>

      <div class="chart-card span-12 methodology">
        <h2>Methodology & data sources (dynamic)</h2>
        <p style="color:var(--muted)">
          This section updates as you change geographies and as cached datasets become available.
          All sources link to the primary publisher.
        </p>
        <div id="methodology"></div>
      </div>
    </section>
  </main>
</body>
</html>
